{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.8; }
    }
    @keyframes shimmer {
        0% { background-position: -1000px 0; }
        100% { background-position: 1000px 0; }
    }
    @keyframes slideIn {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
    }
    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    .fade-in-up { 
        animation: fadeInUp 0.6s ease-out forwards; 
    }
    .auction-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0;
        animation: fadeInUp 0.6s ease-out forwards;
        position: relative;
        overflow: hidden;
        background: white;
    }
    .auction-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.03), transparent);
        transition: left 0.5s;
    }
    .auction-card:hover::after { left: 100%; }
    .auction-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(139, 92, 246, 0.15);
        border-color: #a78bfa;
    }
    .filter-btn {
        transition: all 0.25s ease;
        font-weight: 600;
    }
    .filter-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
    }
    .filter-btn.active {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }
    .search-input {
        transition: all 0.3s ease;
    }
    .search-input:focus {
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.15);
        border-color: #8b5cf6;
        transform: translateY(-1px);
    }
    .pulse-animation { animation: pulse 2s infinite; }
    .stat-card {
        transition: all 0.3s ease;
        background: white;
    }
    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(139, 92, 246, 0.15);
    }
    .stat-icon { 
        transition: all 0.3s ease;
    }
    .stat-card:hover .stat-icon {
        transform: scale(1.1) rotate(5deg);
    }
    .info-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.25rem 0.625rem;
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-radius: 9999px;
    }
    .countdown {
        font-variant-numeric: tabular-nums;
        font-family: 'Courier New', monospace;
        font-weight: 800;
    }
    .action-btn {
        transition: all 0.2s ease;
    }
    .action-btn:hover {
        transform: scale(1.05);
    }
    .gradient-border::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #8b5cf6, #ec4899, #f59e0b);
        animation: shimmer 3s infinite;
        background-size: 200% 100%;
    }
    .auction-card:nth-child(1) { animation-delay: 0.05s; }
    .auction-card:nth-child(2) { animation-delay: 0.1s; }
    .auction-card:nth-child(3) { animation-delay: 0.15s; }
    .auction-card:nth-child(4) { animation-delay: 0.2s; }
    .auction-card:nth-child(5) { animation-delay: 0.25s; }
    .auction-card:nth-child(6) { animation-delay: 0.3s; }
    .delay-1 { animation-delay: 0.1s; opacity: 0; }
    .delay-2 { animation-delay: 0.2s; opacity: 0; }
    .delay-3 { animation-delay: 0.3s; opacity: 0; }
    .delay-4 { animation-delay: 0.4s; opacity: 0; }
    
    .compact-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        background: #f8fafc;
        border-radius: 0.5rem;
        transition: all 0.2s;
    }
    .compact-info:hover {
        background: #f1f5f9;
        transform: translateX(2px);
    }
    .compact-icon {
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.5rem;
        flex-shrink: 0;
    }
    @media (max-width: 640px) {
        .auction-card { margin-bottom: 0.75rem; }
    }
</style>

<div class="bg-gradient-to-br from-slate-50 via-violet-50 to-pink-50 min-h-screen">
<div class="max-w-screen-2xl mx-auto px-4 md:px-6 py-6 md:py-8">
    
    <!-- Page Header -->
    <div class="mb-6 fade-in-up">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <h1 class="text-3xl md:text-4xl font-black text-slate-800 mb-1 tracking-tight">
                    <i class="fas fa-gavel text-violet-600 mr-2"></i>All Auctions
                </h1>
                <p class="text-sm md:text-base text-slate-600 font-medium">
                    Browse <span class="text-violet-600 font-bold">{{ auctions.count }}</span> auction{{ auctions.count|pluralize }}
                </p>
            </div>
            <div class="flex flex-col sm:flex-row gap-2">
                <a href="{% url 'auction_report' %}" class="px-4 py-2.5 bg-white border border-slate-300 text-slate-700 font-bold hover:border-violet-600 shadow-md hover:shadow-lg transition text-sm uppercase rounded-lg">
                    <i class="fas fa-print mr-1.5"></i>Print
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-6">
        <div class="stat-card border border-slate-200 p-4 fade-in-up delay-1 rounded-xl">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs text-slate-500 font-bold uppercase mb-1">Total</p>
                    <p class="text-2xl md:text-3xl font-black text-slate-800">{{ auctions.count }}</p>
                </div>
                <div class="stat-icon w-12 h-12 bg-violet-100 flex items-center justify-center rounded-xl">
                    <i class="fas fa-layer-group text-violet-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="stat-card border border-emerald-200 p-4 fade-in-up delay-2 rounded-xl">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs text-emerald-600 font-bold uppercase mb-1">Live</p>
                    <p class="text-2xl md:text-3xl font-black text-emerald-600">{{ live_count }}</p>
                </div>
                <div class="stat-icon w-12 h-12 bg-emerald-100 flex items-center justify-center rounded-xl">
                    <i class="fas fa-circle text-emerald-600 text-xl pulse-animation"></i>
                </div>
            </div>
        </div>

        <div class="stat-card border border-blue-200 p-4 fade-in-up delay-3 rounded-xl">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs text-blue-600 font-bold uppercase mb-1">Scheduled</p>
                    <p class="text-2xl md:text-3xl font-black text-blue-600">{{ scheduled_count }}</p>
                </div>
                <div class="stat-icon w-12 h-12 bg-blue-100 flex items-center justify-center rounded-xl">
                    <i class="fas fa-calendar-check text-blue-600 text-xl"></i>
                </div>
            </div>
        </div>

        <div class="stat-card border border-slate-200 p-4 fade-in-up delay-4 rounded-xl">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs text-slate-500 font-bold uppercase mb-1">Completed</p>
                    <p class="text-2xl md:text-3xl font-black text-slate-800">{{ completed_count }}</p>
                </div>
                <div class="stat-icon w-12 h-12 bg-slate-100 flex items-center justify-center rounded-xl">
                    <i class="fas fa-flag-checkered text-slate-600 text-xl"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter -->
    <div class="bg-white border border-slate-200 shadow-md mb-6 p-5 md:p-6 fade-in-up gradient-border rounded-xl relative">
        <div class="mb-5">
            <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">
                <i class="fas fa-search mr-1 text-violet-600"></i>Search
            </label>
            <div class="relative">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Search auctions..."
                    class="search-input w-full px-4 py-2.5 border border-slate-300 focus:outline-none focus:border-violet-500 text-sm rounded-lg"
                >
                <i class="fas fa-search absolute right-3 top-3 text-slate-400"></i>
            </div>
        </div>

        <div class="mb-4">
            <label class="block text-xs font-bold text-slate-700 mb-2 uppercase tracking-wide">
                <i class="fas fa-filter mr-1 text-violet-600"></i>Filter
            </label>
            <div class="flex flex-wrap gap-2">
                <button class="filter-btn active px-3 py-2 bg-violet-600 text-white font-bold text-xs uppercase rounded-lg" data-filter="all">
                    All
                </button>
                <button class="filter-btn px-3 py-2 bg-white border border-slate-300 text-slate-700 font-bold text-xs uppercase rounded-lg" data-filter="live">
                    Live
                </button>
                <button class="filter-btn px-3 py-2 bg-white border border-slate-300 text-slate-700 font-bold text-xs uppercase rounded-lg" data-filter="scheduled">
                    Scheduled
                </button>
                <button class="filter-btn px-3 py-2 bg-white border border-slate-300 text-slate-700 font-bold text-xs uppercase rounded-lg" data-filter="approved">
                    Approved
                </button>
                {% if user.is_staff %}
                <button class="filter-btn px-3 py-2 bg-white border border-slate-300 text-slate-700 font-bold text-xs uppercase rounded-lg" data-filter="pending">
                    Pending
                </button>
                {% endif %}
                <button class="filter-btn px-3 py-2 bg-white border border-slate-300 text-slate-700 font-bold text-xs uppercase rounded-lg" data-filter="completed">
                    Completed
                </button>
            </div>
        </div>

        <div class="pt-4 border-t border-slate-200">
            <p class="text-sm text-slate-600 font-semibold">
                <i class="fas fa-chart-bar text-violet-600 mr-1"></i>
                Showing <span id="resultCount" class="text-violet-600 font-black">{{ auctions.count }}</span> result(s)
            </p>
        </div>
    </div>

    <!-- Auctions Grid -->
    <div id="auctionsGrid" class="grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-4">
        {% for auction in auctions %}
        <div class="auction-card bg-white border border-slate-200 shadow-sm rounded-xl" 
             data-title="{{ auction.title|lower }}" 
             data-location="{{ auction.location|lower }}"
             data-type="{{ auction.auction_type }}"
             data-status="{{ auction.status }}">
            
            <!-- Compact Header -->
            <div class="p-4 border-b border-slate-100">
                <div class="flex items-start justify-between gap-2 mb-3">
                    <div class="flex-1 min-w-0">
                        <h3 class="text-lg md:text-xl font-black text-slate-900 hover:text-violet-600 transition leading-tight mb-2 truncate">
                            {{ auction.title }}
                        </h3>
                        <div class="flex flex-wrap items-center gap-1.5 mb-2">
                            <span class="info-badge bg-slate-800 text-white">
                                {{ auction.get_auction_type_display }}
                            </span>
                            {% if auction.location %}
                            <span class="info-badge bg-violet-100 text-violet-700">
                                <i class="fas fa-map-marker-alt text-xs"></i>{{ auction.location|truncatewords:1 }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex-shrink-0">
                        {% if auction.status == 'live' %}
                        <span class="info-badge bg-emerald-500 text-white">
                            <i class="fas fa-circle text-xs pulse-animation"></i>Live
                        </span>
                        {% elif auction.status == 'scheduled' %}
                        <span class="info-badge bg-blue-500 text-white">
                            <i class="far fa-clock text-xs"></i>Soon
                        </span>
                        {% elif auction.status == 'approved' %}
                        <span class="info-badge bg-violet-600 text-white">
                            <i class="fas fa-check text-xs"></i>OK
                        </span>
                        {% elif auction.status == 'pending' %}
                        <span class="info-badge bg-amber-500 text-white">
                            <i class="fas fa-clock text-xs"></i>Wait
                        </span>
                        {% elif auction.status == 'completed' %}
                        <span class="info-badge bg-slate-800 text-white">
                            <i class="fas fa-flag-checkered text-xs"></i>Done
                        </span>
                        {% elif auction.status == 'draft' %}
                        <span class="info-badge bg-slate-400 text-white">
                            <i class="fas fa-file-alt text-xs"></i>Draft
                        </span>
                        {% endif %}
                    </div>
                </div>

                <p class="text-xs text-slate-500 line-clamp-2 mb-2">
                    {{ auction.description|truncatewords:15 }}
                </p>

                <!-- Creator Info Compact -->
                <div class="flex items-center gap-2 text-xs">
                    <div class="flex items-center gap-1 text-slate-600">
                        <i class="fas fa-user-circle text-violet-600"></i>
                        <span class="font-semibold">{{ auction.created_by.username|truncatechars:12 }}</span>
                    </div>
                    {% if auction.approved_by %}
                    <div class="flex items-center gap-1 text-green-600">
                        <i class="fas fa-check-circle"></i>
                        <span class="font-semibold">{{ auction.approved_by.username|truncatechars:10 }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Countdown Section Compact -->
            {% if auction.status == 'scheduled' and auction.start_date %}
            <div class="px-4 py-2.5 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200">
                <div class="flex items-center justify-between">
                    <span class="text-xs font-bold text-blue-900 uppercase">
                        <i class="far fa-clock mr-1"></i>Starts
                    </span>
                    <div class="countdown text-sm font-black text-blue-600" 
                         data-target="{{ auction.start_date|date:'c' }}">
                        Calculating...
                    </div>
                </div>
            </div>
            {% elif auction.status == 'live' and auction.end_date %}
            <div class="px-4 py-2.5 bg-gradient-to-r from-emerald-50 to-emerald-100 border-b border-emerald-200">
                <div class="flex items-center justify-between">
                    <span class="text-xs font-bold text-emerald-900 uppercase">
                        <i class="fas fa-fire mr-1"></i>Ends
                    </span>
                    <div class="countdown text-sm font-black text-emerald-600" 
                         data-target="{{ auction.end_date|date:'c' }}">
                        Calculating...
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Compact Info Grid -->
            <div class="p-4 bg-slate-50 space-y-2">
                <!-- Key Metrics Row -->
                <div class="grid grid-cols-2 gap-2">
                    <div class="compact-info">
                        <div class="compact-icon bg-violet-100">
                            <i class="fas fa-layer-group text-violet-600 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 font-bold uppercase">Lots</p>
                            <p class="text-base font-black text-slate-800">{{ auction.total_lots }}</p>
                        </div>
                    </div>

                    <div class="compact-info">
                        <div class="compact-icon bg-amber-100">
                            <i class="fas fa-sack-dollar text-amber-600 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 font-bold uppercase">Value</p>
                            <p class="text-base font-black text-amber-600">₹{{ auction.total_value|floatformat:0|default:"0" }}</p>
                        </div>
                    </div>
                </div>

                <!-- Settings Row -->
                <div class="grid grid-cols-2 gap-2">
                    <div class="compact-info">
                        <div class="compact-icon bg-indigo-100">
                            <i class="fas fa-arrows-up-down text-indigo-600 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 font-bold">Inc.</p>
                            <p class="text-sm font-black text-indigo-600">₹{{ auction.min_bid_increment|floatformat:0 }}</p>
                        </div>
                    </div>

                    <div class="compact-info">
                        <div class="compact-icon bg-rose-100">
                            <i class="fas fa-percent text-rose-600 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 font-bold">Premium</p>
                            <p class="text-sm font-black text-rose-600">{{ auction.buyer_premium_percentage }}%</p>
                        </div>
                    </div>
                </div>

                <!-- Dates if available -->
                {% if auction.start_date or auction.end_date %}
                <div class="pt-2 space-y-1.5">
                    {% if auction.start_date %}
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-slate-500 font-semibold">
                            <i class="far fa-calendar-plus text-blue-600 mr-1"></i>Start
                        </span>
                        <span class="text-slate-700 font-bold">{{ auction.start_date|date:"M d, g:i A" }}</span>
                    </div>
                    {% endif %}
                    {% if auction.end_date %}
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-slate-500 font-semibold">
                            <i class="far fa-calendar-times text-rose-600 mr-1"></i>End
                        </span>
                        <span class="text-slate-700 font-bold">{{ auction.end_date|date:"M d, g:i A" }}</span>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Additional Features -->
                <div class="flex flex-wrap gap-1.5 pt-2">
                    {% if auction.allow_proxy_bidding %}
                    <span class="info-badge bg-green-100 text-green-700">
                        <i class="fas fa-robot text-xs"></i>Proxy
                    </span>
                    {% endif %}
                    <span class="info-badge bg-slate-100 text-slate-700">
                        <i class="fas fa-clock text-xs"></i>{{ auction.created_at|timesince }} ago
                    </span>
                </div>
            </div>

            <!-- Compact Footer -->
            <div class="p-3 bg-white border-t border-slate-100 flex gap-2">
                <a href="" class="action-btn flex-1 text-center px-3 py-2 bg-gradient-to-r from-violet-600 to-violet-700 text-white font-bold uppercase text-xs rounded-lg hover:shadow-md">
                    <i class="fas fa-eye mr-1"></i>View
                </a>
                {% if user.is_staff and auction.status == 'pending' %}
                <button onclick="approveAuction('{{ auction.id }}')" class="action-btn px-3 py-2 bg-emerald-500 text-white hover:bg-emerald-600 font-bold rounded-lg text-xs">
                    <i class="fas fa-check"></i>
                </button>
                {% endif %}
                {% if auction.can_edit %}
                <a href="" class="action-btn px-3 py-2 bg-slate-100 border border-slate-300 text-slate-700 hover:bg-slate-200 rounded-lg text-xs">
                    <i class="fas fa-edit"></i>
                </a>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="col-span-full text-center py-12 bg-white border border-slate-200 rounded-xl">
            <i class="fas fa-gavel text-slate-300 text-5xl mb-4"></i>
            <h3 class="text-xl font-black text-slate-700 mb-2">No Auctions Available</h3>
            <p class="text-slate-500 mb-4 text-sm">Be the first to create an auction</p>
            {% if user.is_authenticated %}
            <a href="{% url 'create_auction' %}" class="inline-block px-6 py-2.5 bg-violet-600 text-white font-bold hover:bg-violet-700 text-sm uppercase rounded-lg">
                <i class="fas fa-plus-circle mr-1.5"></i>Create Auction
            </a>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- No Results -->
    <div id="noResults" class="hidden text-center py-12 bg-white border border-slate-200 rounded-xl mt-4">
        <i class="fas fa-search text-slate-300 text-5xl mb-4"></i>
        <h3 class="text-xl font-black text-slate-700 mb-2">No Matching Auctions</h3>
        <p class="text-slate-500 mb-4 text-sm">Try adjusting your filters</p>
        <button onclick="resetFilters()" class="px-5 py-2.5 bg-violet-600 text-white font-bold hover:bg-violet-700 rounded-lg text-sm">
            <i class="fas fa-redo mr-1.5"></i>Reset
        </button>
    </div>
</div>
</div>

<script>
    const searchInput = document.getElementById('searchInput');
    const filterButtons = document.querySelectorAll('.filter-btn');
    const auctionCards = document.querySelectorAll('.auction-card');
    const resultCount = document.getElementById('resultCount');
    const noResults = document.getElementById('noResults');
    const auctionsGrid = document.getElementById('auctionsGrid');

    let currentFilter = 'all';
    let currentSearch = '';

    // Search functionality
    searchInput.addEventListener('input', (e) => {
        currentSearch = e.target.value.toLowerCase().trim();
        filterAuctions();
    });

    // Filter button functionality
    filterButtons.forEach(button => {
        button.addEventListener('click', () => {
            filterButtons.forEach(btn => {
                btn.classList.remove('active', 'bg-violet-600', 'text-white');
                btn.classList.add('bg-white', 'border', 'border-slate-300', 'text-slate-700');
            });
            
            button.classList.add('active', 'bg-violet-600', 'text-white');
            button.classList.remove('bg-white', 'border', 'border-slate-300');
            
            currentFilter = button.dataset.filter;
            filterAuctions();
        });
    });

    // Filter auctions based on search and filter
    function filterAuctions() {
        let visibleCount = 0;

        auctionCards.forEach(card => {
            const title = card.dataset.title;
            const location = card.dataset.location;
            const type = card.dataset.type;
            const status = card.dataset.status;

            const matchesSearch = currentSearch === '' || 
                title.includes(currentSearch) || 
                location.includes(currentSearch) ||
                type.includes(currentSearch);

            const matchesFilter = currentFilter === 'all' || status === currentFilter;

            if (matchesSearch && matchesFilter) {
                card.style.display = 'block';
                setTimeout(() => card.style.opacity = '1', 50);
                visibleCount++;
            } else {
                card.style.opacity = '0';
                setTimeout(() => card.style.display = 'none', 300);
            }
        });

        resultCount.textContent = visibleCount;

        if (visibleCount === 0) {
            auctionsGrid.classList.add('hidden');
            noResults.classList.remove('hidden');
        } else {
            auctionsGrid.classList.remove('hidden');
            noResults.classList.add('hidden');
        }
    }

    // Reset filters
    function resetFilters() {
        searchInput.value = '';
        currentSearch = '';
        currentFilter = 'all';
        
        filterButtons.forEach(btn => {
            btn.classList.remove('active', 'bg-violet-600', 'text-white');
            btn.classList.add('bg-white', 'border', 'border-slate-300', 'text-slate-700');
        });
        
        const allButton = document.querySelector('[data-filter="all"]');
        if (allButton) {
            allButton.classList.add('active', 'bg-violet-600', 'text-white');
            allButton.classList.remove('bg-white', 'border', 'border-slate-300');
        }
        
        filterAuctions();
    }

    // Update countdown timers
    function updateCountdowns() {
        const countdowns = document.querySelectorAll('.countdown');
        
        countdowns.forEach(elem => {
            const target = new Date(elem.dataset.target).getTime();
            const now = new Date().getTime();
            const distance = target - now;

            if (distance < 0) {
                elem.textContent = 'EXPIRED';
                elem.classList.add('text-red-600');
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            if (days > 0) {
                elem.textContent = `${days}d ${hours}h ${minutes}m`;
            } else if (hours > 0) {
                elem.textContent = `${hours}h ${minutes}m ${seconds}s`;
            } else if (minutes > 0) {
                elem.textContent = `${minutes}m ${seconds}s`;
            } else {
                elem.textContent = `${seconds}s`;
            }
        });
    }

    // Approve auction function (for staff)
    function approveAuction(auctionId) {
        if (!confirm('Are you sure you want to approve this auction?')) {
            return;
        }

        fetch(`/auctions/${auctionId}/approve/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error approving auction: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error approving auction');
        });
    }

    // Get CSRF token from cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Initialize countdowns and update every second
    updateCountdowns();
    setInterval(updateCountdowns, 1000);

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        filterAuctions();
    });
</script>

{% endblock %}